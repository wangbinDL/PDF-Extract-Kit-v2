# 2019 年罗马尼亚大师杯数学竞赛 (RMM) 

组合部分试题选讲

叶奇卉<br>（浙江温州乐清市乐成寄宿中学，325600）<br>指导教师: 年晓生

罗马尼亚大师杯数学竞赛（RMM）是由罗马尼亚数学奥林匹克国家队队员组成的国家队培训时举办的一项赛事，自2008年起每年夏天各办一届，是一个在国际上影响较大的比赛。本文介绍2019年 RMM 组合部分的试题，共 3 道题. 作者认为第二题相对简单，第一题和第三题较难。

鉴于笔者水平，文中如有不当之处，还请读者批评指正。

## I. 试 题

1. 已知正整数 $k, N$ 满足: $k>1, N>2 k+1$. 现有 $N$ 个人围成一圈坐下, 其中每个人要么是间谍（总是说谎话）要么是诚实（总是讲真话），且每个人都可以看到自己顺时针方向上的 $k$ 个人和逆时针方向上的 $k$ 个人。如果每个人都说"我能看见的顺时针方向的间谍人数和逆时针方向的间谍人数一样多"。那么，是否每个人都是间谍?
2. 给定正整数 $n \geq 2$ 。我们在一个 $3 n \times 3 n$ 的国际象棋棋盘的某个单元格中放置一枚棋子"王"，已知"王"在每一步可以向上移动一格，或向右移动一格，或向其左下方移动一格. 若经过 $k$ 步之后，该棋子回到了初始位置，并且移动过程中每个单元格至多经过一次。试求 $k$ 的最大值.
3. 给定奇数 $n>1$, 对 $1,2, \cdots, n$ 的一个排列 $p_{1}, \cdots, p_{n}$, 记 $S$ 为满足: 当 $1 \leq i \leq j \leq n$ 时, 有 $n \mid p_{i}+p_{i+1}+\cdots+p_{j}$ 的数对 $(i, j)$ 的数量。求 $S$ 的最大值.

\footnotetext{
修订日期: 2020-07-16.




---

# II. 解答与评注 

1. 已知正整数 $k$, $N$ 满足: $k>1, N>2 k+1$. 现有 $N$ 个人围成一圈玩游戏, 其中每个人要么是骑士（永远说真话）要么是间谍（永远说假话），且每个人都可以看到他顺时针方向的 $k$ 个人和逆时针方向的 $k$ 个人。如果每个人都说"我能看见的顺时针的骑士人数和逆时针的骑士人数一样多"。那么, 是否每个人都是骑士?

解 当 $(N, 2 k+1)=1$ 时, 每个人都是骑士; 当 $(N, 2 k+1)>1$ 时, 不一定每个人都是骑士.

一方面，当 $(N, 2 k+1)=d>1$ 时，进行构造：
对于 $1 \leq i \leq N$ ，当 $i \equiv 1(\bmod d)$ 时，令第 $i$ 人为骑士，否则令第 $i$ 人为间谍。
此时对于每一个间谍, 注意到连续 $2 k+1$ 人中恰有 $\frac{2 k+1}{d}$ 个骑士, 那么间谍往前看到的骑士数为 $\frac{2 k+1}{d}$ 奇数个，与逆时针看到的骑士数奇偶性不同，那么间谍说谎，满足要求。而针对于每一个骑士，他顺时针 $k$ 人与逆时针 $k$ 人是对称的，他永远说真话，满足要求。

另一方面，我们证明 $(N, 2 k+1)=1$ 时，每个人都为骑士。令

$$
f(i)= \begin{cases}1, & \text { 第 } i \text { 人为骑士, } \\ 0, & \text { 第 } i \text { 人为间谍, }\end{cases}
$$

$(1 \leq i \leq N)$, 且 $f(i+N)=f(i),(i \in \mathbb{Z})$.
令

$$
g(i)=\sum_{j=i-k}^{i} f(j)-\sum_{j=i}^{i+k} f(j)
$$

由条件知, $f(i)=0$ 时, $g(i) \neq 0 ; f(i)=1$ 时, $g(i)=0$. 由 $g(i)$ 表达式知,

$$
g(i+1)-g(i)=f(i+1)+f(i)-f(i-k)-f(i+k+1)
$$

首先, $f(i)$ 不全为 0 。否则，结合 $g(i)$ 表达式知， $g(i)$ 全为 0 ，与 $f(i)=0$ 时， $g(i) \neq 0$矛盾!

下对 $g(i+1)-g(i)$ 的值分类讨论.
(1) 当 $f(i)=f(i+1)=0$ 时, 结合 $(*)$, 有

$$
g(i+1)-g(i)=-f(i-k)-f(i+k+1) \leq 0
$$

(2) 当 $f(i)=0, f(i+1)=1$ 时, 有 $g(i+1)=0, g(i) \neq 0$. 结合 $(*)$, 有

$$
-g(i)=g(i+1)-g(i)=1-f(i-k)-f(i+k+1)
$$




---

而 $f(i-k) \in\{0,1\}, f(i+k+1) \in\{0,1\}$, 所以

$$
1-f(i-k)-f(i+k+1) \in\{-1,0,1\}
$$

结合 $g(i) \neq 0$ 知, $g(i) \in\{-1,1\}, g(i+1)-g(i) \in\{-1,1\}$ 。
(3) 当 $f(i)=1, f(i+1)=0$ 时, 与(2)同理, 知 $g(i+1)-g(i) \in\{-1,1\}$.

I）下面考虑使得 $f(i)=0$ 的 $i$ 。结合 $f(i)$ 不全为 0 知，存在最小的 $s, t \in \mathbb{N}^{*}$,使得

$$
f(i-s)=f(i+t)=1
$$

结合(2)(3)与 $g(i-s)=g(i+t)=0$ 知，

$$
g(i-s+1), g(i+t-1) \in\{-1,1\}
$$

再结合(1)知，

$$
1 \geq g(i-s+1) \geq g(i-s+2) \geq \cdots \geq g(i+t-1) \geq-1
$$

而由 $f(i)=0$ 知 $g(i) \neq 0$, 结合 $|g(i)| \leq 1$ 知 $2 \nmid g(i)$, 那么

$$
f(i)-g(i) \equiv 1 \quad(\bmod 2)
$$

II) 再考虑使得 $f(i)=1$ 的 $i$, 此时 $g(i)=0$,

$$
f(i)-g(i) \equiv 1 \quad(\bmod 2)
$$

那么对于 $\forall i \in \mathbb{Z}, f(i)-g(i) \equiv 1(\bmod 2)$ ，代入 $(*)$ 得

$$
f(i-k) \equiv f(i+k+1)(\bmod 2)
$$

那么 $f(i-k)=f(i+k+1)$. 于是 $2 k+1$ 为 $f(i)$ 的周期, 结合 $N$ 为周期知, $(2 k+1, N)=1$ 也为 $f(i)$ 的周期。而 $f(i)$ 不全为 0 ，所以 $f(i)$ 全为 1 。

综上， $(N, 2 k+1)=1$ 时，每个人都为骑士， $(N, 2 k+1)>1$ 时，不一定每人为骑士。

评注 本题易想到从一个具有特殊意义的"值"考虑，经过一定的推理，可找到关于该"值"的变化规律, 从而找到思路.
2. 给定正整数 $n \geq 2$ 。我们在一个 $3 n \times 3 n$ 的国际象棋棋盘的某个单元格中放置一枚棋子"王"，已知"王"在每一步可以向上移动一格，或向右移动一格，或向其左下方移动一格. 若经过 $k$ 步之后，该棋子回到了初始位置，并且移动过程中每个单元格至多经过一次。试求 $k$ 的最大值.

解 $k$ 的最大值为 $9 n^{2}-3$.




---

(i) 一方面，给出构造：对 $3 n \times 3 n$ 长方形格表从左至右、从上至下依次编号为 $1,2, \cdots, 3 n$. 对第 $i$ 行，第 $j$ 列的格子，记为 $(i, j)(1 \leq i, j \leq 3 n)$. 对空的格子 $(i, j)$ :
x 如果 $i=3 s(s=1,2, \cdots, n)$ 及 $j=1$ 或 $j=t(t=3,4, \cdots, 3 n+1)$ 或

$$
(i, j)=(3 n, 2) \text { 时, 则空格子右下方格子记为 } r \text {. }
$$

$y$ 如果 $s=3 n-1(s=1,2, \cdots, n)$ 及 $j=t(t=3,4, \cdots, 3 n)$ 时或 $i=3 s(s=$ $1,2, \cdots, n)$ 及 $j=3 n$ 时，空格子均记为 $r$ 。

z 对除了 $(1,1),(1,2),(2,1)$ 及 $x, y$ 中格子外的格子时，空格子左上方格子记为 $r$.

连出空格子右下方格子（空格子右方（3n， 1）处），如图 1，易满足要求，且 $k=9 n^{2}-3$ 。

图1
(ii) 另一方面，假设 $k>9 n^{2}-3$ ，注意到空格子只剩一个，那么空格子左下方格子必定为 $t$ 色，而右边格子为 $t$ 色。于是空格子的颜色为 3 的倍数，故 $3 \mid k$ 。又 $k \leq 9 n^{2}$ ，知 $k=9 n^{2}$ 。即整个表格全为同色的格。

那么, 我们考虑与上下左右邻为 (1, 1), (1, 2), (2,1); ( 3 n - 1, $3 n),(3 n, 3 n-1),(3 n, 3 n)$. 注意到要过 $(1,1),(3 n, 3 n)$ 结合空格子右下方格子知必先要改变 $(2,1) \rightarrow(1,1) \rightarrow(1,2)$ ，

$$
(3 n, 3 n-1) \rightarrow(3 n, 3 n) \rightarrow(3 n-1,3 n)
$$

图 2




---

如图 $2 、$ 整个赛程左起是段 $(1,2)$ 绕到 $(3 n, 3 n-1)$ 且从 $(3 n-$ $1,3 n)$ 绕到 $(2,1)$. 分别称其为赛程 $M$ ，赛程 $N$ ，则 $M$ 将路程分为两部分， $(2,1),(3 n-1,3 n)$ 各在一部分. 于是易知 $N$ 一定与赛程 $M$ 相交. 而无论赛程 $M$ 在交点处是 $\rightarrow$ 或者 $\uparrow$ 或者 $\swarrow$, 模三都是在某一确定的位置上增加了至多 1 . 这样不难看出该情况下仍然成立, 否则必有小虫, 但模三能唯一确定来历, 故不成立. 因此 $k \leq 9 n^{2}-3$.

综上, $k$ 的最大值为 $9 n^{2}-3$.
评注 本题关键在于两个方面，一是先猜出答案，发现竟然是 3 个虫子不到是最无关紧要的. 这里从小的 $n$ 开始是可取的。另一个就是仔细观察路线，即左上角，右下角，分析就可以完全证明。
3. 给定奇数 $n>1$, 对 $1,2, \cdots, n$ 的一个排列 $p_{1}, \cdots, p_{n}$, 记 $S$ 为满足: 当 $1 \leq i \leq j \leq n$ 时, 有 $n \mid p_{i}+p_{i+1}+\cdots+p_{j}$ 的数对 $(i, j)$ 的数量. 求 $S$ 的最大值.

解 $1 S_{\text {max }}=\frac{(n+1)(n+3)}{8}$.
(1) 一方面, 取 $\left(p_{1}, p_{2}, \cdots, p_{n}\right)=(n, 1, n-1,2, n-2, \cdots, \frac{n-1}{2}, \frac{n+1}{2})$ 。考虑 $n \mid p_{i}+\cdots+p_{j}$ 的 $(i, j)$ 对。将 $n,(1, n-1),(2, n-2), \cdots,\left(\frac{n-1}{2}, \frac{n+1}{2}\right)$ 看作 $\frac{n+1}{2}$ 个整体。任意取一个连续和均为一个满足要求的排列，所以

$$
S \geq \mathrm{C}_{\frac{n+1}{2}}^{2}+\frac{n+1}{2}=\frac{(n+1)(n+3)}{8}
$$

(2) 另一方面, 下面证明 $S \leq \frac{(n+1)(n+3)}{8}$.

为了记, 记

$$
\sigma_{i j}=p_{i}+p_{i+1}+\cdots+p_{j}, 1 \leq i \leq j \leq n
$$

我们将部分分为 3 类。

$$
\begin{aligned}
& A=\left\{(i, j) \mid n \mid \sigma_{i j} \text { 且 } p_{i}=n \text { 或 } p_{j}=n\right\} \\
& B=\left\{(i, j) \mid n \mid \sigma_{i j} \text { 且 } n \mid p_{i}+p_{j} \text { 且 } p_{i}, p_{j} \neq n\right\} \\
& C=\left\{(i, j) \mid n \mid \sigma_{i j} \text { 且 } n \nmid p_{i}+p_{j} \text { 且 } p_{i}, p_{j} \neq n\right\}
\end{aligned}
$$

则 $S=|A|+|B|+|C|$.
设 $p_{t}=n$ ，则 $(t, t) \in A,(t-1, t),(t, t+1)$ 均不在 $A, B, C$ 中. 先考虑 $(i, t), i<t-1$, 将数对对 (可能为空) 如下:

$$
((t-2, t),(t-3, t)),((t-4, t),(t-5, t)), \cdots
$$

每一对里多一个在 $A$ 中, 否则 $n \mid \sigma_{i, t}, n \mid \sigma_{i-1, t},(i=t-2, t-4, \cdots)$ 两式




---

相加 $n \mid p_{i}$ 与 $i \neq t$ 矛盾! 因此 $(i, t), i<t-1$ 中至多有 $\left(\frac{t-2+1}{2}\right)$ 个. 类似的 $(i, t), i>t+1$ 中至多有 $\left(\frac{n-t-1+1}{2}\right)$ 个. 所以

$$
|A| \leq\left[\frac{t-2+1}{2}\right]+\left[\frac{n-t-1+1}{2}\right]+1 \leq n+\frac{1}{2} \quad(\text { 有 }(t, t) \in A)
$$

对 $B$ 中任意元素 $(i, j)$ 有 $n \mid p_{i}+p_{j}$. 至多 $\frac{n-1}{2}$ 对， 则 $|B| \leq \frac{n-1}{2}$.
再考虑 $C$ 中的元素, 注意到 $i, j \neq t$, 且 $n \mid n$. 故 $p_{t}$ 在对应 $\sigma_{i j}$ 的 $\bmod n$ 的余数中无解. 不妨设 $t=n$. 记 $K_{i}=\{2 i-1,2 i\}, 1 \leq i \leq \frac{n-1}{2}$. 注意到 $C$ 中的元素 $(i, j)$ 满足 $n \nmid p_{i}+p_{j}$. 因此 $(i, j)$ 不在同一个 $K_{u}\left(1 \leq u \leq \frac{n-1}{2}\right)$ 中.设 $i \in K_{u_{1}}, j \in K_{u_{2}}, u_{1}<u_{2}$. 考虑 $\sigma_{2 u_{1}-1,2 u_{2}-1}, \sigma_{2 u_{1}-1,2 u_{2}}, \sigma_{2 u_{1}, 2 u_{2}-1}, \sigma_{2 u_{1}, 2 u_{2}}$.下证这四个元素至多有一个在 $C$ 中.

否则，至少两个在 $C$ 中，由于 $p_{2 u_{1}-1}, p_{2 u_{1}}, p_{2 u_{2}-1}, p_{2 u_{2}} \not \equiv 0(\bmod n)$.
若 $\left(2 u_{1}-1,2 u_{2}-1\right) \in C$ ，则 $\left(2 u_{1}, 2 u_{2}-1\right) \notin C,\left(2 u_{1}-1,2 u_{2}\right) \notin C$ 。从而 $\left(2 u_{1}, 2 u_{2}\right) \in C$ 。于是 $p_{2 u_{1}-1} \equiv p_{2 u_{2}}(\bmod n)$ ，矛盾！
故 $\left(2 u_{1}-1,2 u_{2}-1\right) \notin C$ ，同理 $\left(2 u_{1}, 2 u_{2}\right) \notin C$ 则 $\left(2 u_{1}-1,2 u_{2}\right) \in$ $C,\left(2 u_{1}, 2 u_{2}-1\right) \in C$ 。但由定义可知 $\left(2 u_{1}-1,2 u_{2}\right) \in B$ ，矛盾！故 $\left(2 u_{1}-\right.$ $\left.1,2 u_{2}-1\right),\left(2 u_{1}-1,2 u_{2}\right),\left(2 u_{1}, 2 u_{2}-1\right),\left(2 u_{1}, 2 u_{2}\right)$ 至多一个在 $C$ 中, 可将 $K_{i}$看作整体 $1 \leq i \leq \frac{n-1}{2}$. 因此 $|C| \leq C_{\frac{n-2}{2}}^{2}$. 故

$$
S \leq|A|+|B|+|C| \leq n+\frac{1}{2}+\frac{n-1}{2}+C_{\frac{n-2}{2}}^{2}=\frac{(n+1)(n+3)}{8}
$$

综上, 有

$$
S_{\max }=\frac{(n+1)(n+3)}{8}
$$

评注 答案是容易的，关键在于估计，此处解法完全按照构造的想法估计，很对胃口。还要看命题人如何狡猾，是想两次直接对应"战术"。

解 2 $S_{\max }=C_{\frac{n+3}{2}}^{2}$.
记 $n=2 k+1, k \in \mathbb{N}^{*}$.
一方面，构造 $p$ 使 $S \geq C_{k+2}^{2}$ 。
取 $p_{2 i-1}=i, p_{2 i}=2 k+1-i, i=1, \cdots, k, p_{2 k+1}=2 k+1$, 则 $\forall i, j \in$ $\{0,2,4, \cdots, 2 k, 2 k+1\}, i<j$, 均有 $p_{i+1}+p_{i+2}+\cdots+p_{j}$ 为 $2 k+1$ 的倍数(因为 $2 k+1 \mid p_{2 u-1}+p_{2 u}, u=1, \cdots, k, 2 k+1 \mid p_{2 k+1}$ )。故 $S \geq C_{k+2}^{2}$.
另一方面，证明 $S \leq C_{k+2}^{2}$ 。
记 $\sigma_{j}=p_{1}+p_{2}+\cdots+p_{j}, j=0,1, \cdots, 2 k+1$, 则 $\forall t \in \mathbb{Z}$ ，满足 $1 \leq j \leq 2 k+1$




---

… $\sigma_{j}-\sigma_{j-1} \equiv t(\bmod 2 k+1)$ 的 $j$ 有 $k$ 个。于是， $\forall r \in \mathbb{Z}$ ，满足 $0 \leq j \leq 2 k+1$且 $\sigma_{j} \equiv r(\bmod 2 k+1)$ 的 $j$ 至多 $k+2$ 个（因为这样的 $j$ 中相邻两者至少差一对)。

及 $\forall u, v \in \mathbb{Z}$, 满足 $0 \leq j \leq 2 k+1$ 且 $\sigma_{j} \equiv u$ 或 $v(\bmod 2 k+1)$ 的 $j$ 至多 $k+3$个（因为这样的 $j$ 中相邻两者至少差两对）。

考虑

$$
\sigma_{u} \equiv \sigma_{v} \quad(\bmod 2 k+1)
$$

的有序对 $(u, v)$ 个数. 任取 $i \in\{0,1, \cdots, k\}$ 。
若 $\sigma_{2 i} \not \equiv \sigma_{2 i+1}(\bmod 2 k+1)$ ，则满足 $\sigma_{j} \equiv \sigma_{2 i}$ 或 $\sigma_{2 i+1}(\bmod 2 k+1), 0 \leq$ $j \leq 2 k+1$ 的 $j$ 至多 $k+3$ 个，则 $(*)$ 的满足 $v=2 i$ 或 $2 i+1$ 的解数至多 $k+3$ 个.

若 $\sigma_{2 i} \equiv \sigma_{2 i+1}(\bmod 2 k+1)$ ，则满足 $\sigma_{j} \equiv \sigma_{2 i}(\bmod 2 k+1), 0 \leq j \leq 2 k+1$的 $j$ 至多 $k+2$ 个，则 $(*)$ 的满足 $v=2 i$ 或 $2 i+1$ 的解数至多 $2(k+2)$ 个，且由类 $i$ 至多一个。

因此， $(*)$ 解数至多 $k(k+3)+2(k+2)=k^{2}+5 k+4$ 。
于是, $\sigma_{u} \equiv \sigma_{v}$ 且 $u<v$ 的解 $(u, v)$ 至多

$$
\frac{1}{2}\left(\left(k^{2}+5 k+4\right)-(2 k+2)\right)=\frac{1}{2}\left(k^{2}+3 k+2\right)
$$

即 $s \leq \mathrm{C}_{k+2}^{2}$.
综上， $S_{\max }=\frac{n+3}{2} \mathrm{C}_{n}^{2}$.
评注 本题将连续出现若干次"分组"和"染色"两类思想，也是较为常见手法。两用两个字较好数会不到，结合整体，便将一步考虑两字缩短距离。




---


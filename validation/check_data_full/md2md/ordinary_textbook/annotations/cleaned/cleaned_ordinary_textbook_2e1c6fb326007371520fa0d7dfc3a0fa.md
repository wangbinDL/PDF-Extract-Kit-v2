# 2019 年罗马尼亚大师杯 $(\mathrm{RMM})$ <br> 组合部分预选题 

韩新森<br>(浙江乐清知临中学, 325600)<br>指导教师: 羊明亮

罗马尼亚大师杯 (RMM) 是由罗马尼亚数学会主办的一场国际邀请赛, 自 2008 年开始每年于 2 月举办, 是一个在国际上十分重要的比赛. 本文为 2019 年 RMM 组合部分的预选题, 共 3 道题. 笔者认为第二题相对简单, 第一题和第三题较难.

直于笔者水平, 文中若有不当之处, 请读者批评指正.

## I. 试 题

1. 已知正整数 $k, N$ 满足: $k>1, N>2 k+1$. 现有 $N$ 个人围绕圆桌坐成一圈, 其中每个人要么是骑士(永远说真话)要么是骗子(永远说假话), 且每个人都可以看到他左侧(顺时针方向)的 $k$ 个人和右侧(逆时针方向)的 $k$ 个人. 如果每个人都说“我能看到的左侧的骑士人数和右侧的骑士人数一样多”. 那么, 是否每个人都一定是骑士?
2. 给定正整数 $n \geq 2$. 我们在一个 $3 n \times 3 n$ 的国际象棋棋盘的某个单元格中放置一枚棋子“王”, 已知“王”在每一步可以向上移动一格, 或向右移动一格,或向其左下方移动一格. 若经过 $k$ 步之后, 该棋子回到了初始位置, 并且移动过程中每个单元格至多经过一次. 试求 $k$ 的最大值.
3. 给定奇数 $n>1$, 对 $1,2, \cdots, n$ 的一个排列 $p_{1}, \cdots, p_{n}$, 记 $S$ 为满足: 当 $1 \leq i \leq j \leq n$ 时, 有 $n \mid p_{i}+p_{i+1}+\cdots+p_{j}$ 的数对 $(i, j)$ 的数目. 求 $S$ 的最大值.

## II . 解答与评注

1. 已知正整数 $k, N$ 满足: $k>1, N>2 k+1$. 现有 $N$ 个人围绕圆桌坐成一圈, 其中每个人要么是骑士(永远说真话)要么是骗子(永远说假话), 且每个人都可以看到他左侧(顺时针方向)的 $k$ 个人和右侧(逆时针方向)的 $k$ 个人. 如果每个人都说“我能看到的左侧的骑士人数和右侧的骑士人数一样多”. 那么, 是否每个人都一定是骑士?

解 当 $(N, 2 k+1)=1$ 时, 每个人一定是骑士; 当 $(N, 2 k+1)>1$ 时, 不一定每个人都是骑士.

一方面, 当 $(N, 2 k+1)=d>1$ 时, 进行构造:

对于 $1 \leq i \leq N$, 当 $i \equiv 1(\bmod d)$ 时, 令第 $i$ 人为骑士, 否则令第 $i$ 人为骗子.

此时对于每一个骗子, 注意到连续 $2 k+1$ 人中恰 $\frac{2 k+1}{d}$ 个骑士, 那么骗子看到的骑士数为 $\frac{2 k+1}{d}$ 奇数个, 左右两侧看到的骑士数奇偶性不同, 那么骗子撒谎,满足要求. 而对于每一个骑士, 他左侧 $k$ 人与右侧 $k$ 人是对称的, 他说了真话, 满足要求.

另一方面, 我们证明 $(N, 2 k+1)=1$ 时, 每个人必为骑士. 令

$$
f(i)=\left\{\begin{array}{ll}
1, & \text { 第 } i \text { 人为骑士 }, \\
0, & \text { 第 } i \text { 人为骗子 },
\end{array} \quad(1 \leq i \leq N), \text { 且 } f(i+N)=f(i),(i \in \mathbb{Z})\right. \text {. }
$$

令

$$
g(i)=\sum_{j=i-k}^{i} f(j)-\sum_{j=i}^{i+k} f(j)
$$

由条件知, $f(i)=0$ 时, $g(i) \neq 0 ; f(i)=1$ 时, $g(i)=0$. 由 $g(i)$ 表达式知,

$$
g(i+1)-g(i)=f(i+1)+f(i)-f(i-k)-f(i+k+1),
$$

首先, $f(i)$ 不全为 0 . 不然, 结合 $g(i)$ 表达式知, $g(i)$ 全为 0 , 与 $f(i)=0$ 时, $g(i) \neq 0$矛盾!

下对 $g(i+1)-g(i)$ 的值分类讨论.

①当 $f(i)=f(i+1)=0$ 时, 结合 $(*)$, 有

$$
g(i+1)-g(i)=-f(i-k)-f(i+k+1) \leq 0 .
$$

②当 $f(i)=0, f(i+1)=1$ 时, 有 $g(i+1)=0, g(i) \neq 0$. 结合 $(*)$, 有

$$
-g(i)=g(i+1)-g(i)=1-f(i-k)-f(i+k+1) \text {. }
$$

而 $f(i-k) \in\{0,1\}, f(i+k+1) \in\{0,1\}$, 所以

$$
1-f(i-k)-f(i+k+1) \in\{-1,0,1\}
$$

结合 $g(i) \neq 0$ 知, $g(i) \in\{-1,1\}, g(i+1)-g(i) \in\{-1,1\}$.

③ 当 $f(i)=1, f(i+1)=0$ 时, 与(2)同理, 知 $g(i+1)-g(i) \in\{-1,1\}$.

I) 下面考虑使得 $f(i)=0$ 的 $i$. 结合 $f(i)$ 不全为 0 知, 存在最小的 $s, t \in \mathbb{N}^{*}$,使得

$$
f(i-s)=f(i+t)=1 .
$$

结合②③与 $g(i-s)=g(i+t)=0$ 知,

$$
g(i-s+1), g(i+t-1) \in\{-1,1\}
$$

再结合①知，

$$
1 \geq g(i-s+1) \geq g(i-s+2) \geq \cdots \geq g(i+t-1) \geq-1
$$

而由 $f(i)=0$ 知 $g(i) \neq 0$, 结合 $|g(i)| \leq 1$ 知 $2 \nmid g(i)$, 那么

$$
f(i)-g(i) \equiv 1 \quad(\bmod 2) .
$$

II) 再考虑使得 $f(i)=1$ 的 $i$, 此时 $g(i)=0$,

$$
f(i)-g(i) \equiv 1 \quad(\bmod 2) .
$$

那么对于 $\forall i \in \mathbb{Z}, f(i)-g(i) \equiv 1(\bmod 2)$, 代入 $(*)$ 得

$$
f(i-k) \equiv f(i+k+1) \quad(\bmod 2)
$$

那么 $f(i-k)=f(i+k+1)$. 于是 $2 k+1$ 为 $f(i)$ 的周期, 结合 $N$ 为周期知, $(2 k+1, N)=1$ 也为 $f(i)$ 的周期. 而 $f(i)$ 不全为 0 , 所以 $f(i)$ 全为 1 .

综上, $(N, 2 k+1)=1$ 时, 每个人都为骑士, $(N, 2 k+1)>1$ 时, 不一定每人为骑士.

评注 本题易想到从一个具有特殊意义的“值”考虑, 经过一定的推理, 可找到关于该“值”的变化规律, 从而找到思路.

2. 给定正整数 $n \geq 2$. 我们在一个 $3 n \times 3 n$ 的国际象棋棋盘的某个单元格中放置一枚棋子“王”, 已知“王”在每一步可以向上移动一格, 或向右移动一格,或向其左下方移动一格. 若经过 $k$ 步之后, 该棋子回到了初始位置, 并且移动过程中每个单元格至多经过一次. 试求 $k$ 的最大值.

解 $k$ 的最大值为 $9 n^{2}-3$.

(i) 一方面, 给出构造: 对 $3 n$ 行 $3 n$ 列的方格表自上向下, 自左向右分别为行、列编号 $1,2, \cdots, 3 n$. 对第 $i$ 行, 第 $j$ 列的格子, 记为 $(i, j) 1 \leq i, j \leq 3 n$. 对王在的格子 $(i, j)$ :

① $i=3 s(s=1,2, \cdots, n)$ 及 $j=1$ 或 $j=t(t=3,4, \cdots, 3 n+1)$ 或 $(i, j)=(3 n, 2)$ 时, 则王向右走.

② $s=3 n-1(s=1,2, \cdots, n)$ 及 $j=t(t=3,4, \cdots, 3 n)$ 时或 $i=3 s(s=$ $1,2, \cdots, n)$ 及 $j=3 n$ 时, 王向上走.

③ 对除了 $(1,1),(1,2),(2,1)$ 及 (1), (2)中格子外的格子时, 王向左下走.

连出王行走轨迹(王从 $(3 n, 1)$ 出发), 如图 1 , 是满足要求的, 且 $k=9 n^{2}-3$.



图 1

(ii) 另一方面, 假设 $k>9 n^{2}-3$, 注意到王行走了一个圈, 那么王若向左下方走了 $t$ 步, 则必要向上及向右走 $t$ 步. 于是王走的步数为 3 的倍数, 故 $3 \mid k$. 又 $k \leq 9 n^{2}$, 知 $k=9 n^{2}$. 即王要经过全部的格.

那么, 我们考虑左上方和右下方 $(1,1),(1,2),(2,1) ;(3 n-1,3 n),(3 n, 3 n-$ $1),(3 n, 3 n)$. 注意到要过 $(1,1),(3 n, 3 n)$ 结合王只能向上、向右、向左下走,于是必有 $(2,1) \rightarrow(1,1) \rightarrow(1,2),(3 n, 3 n-1) \rightarrow(3 n, 3 n) \rightarrow(3 n-1,3 n)$.



图 2

如图 2 , 整个路径封闭, 知王一定是从 $(1,2)$ 走到 $(3 n, 3 n-1)$ 且从 $(3 n-$ $1,3 n)$ 走到 $(2,1)$. 分别称其为路径 $M$, 路径 $N$, 则 $M$ 将表分为了两部分, $(2,1)$, $(3 n-1,3 n)$ 各在一部分. 于是路径 $N$ 一定与路径 $M$ 相交. 而无论路径 $M$ 在交点处是 $\rightarrow$ 或 $\uparrow$ 或 $\swarrow$, 王总是在行或列的编号上改变了至少 1 . 这样除非 “ ”如交叉, 否则必有交格, 但王只能向左下移动, 故不成立. 因此 $k \leq 9 n^{2}-3$.

综上, $k$ 的最大值为 $9 n^{2}-3$.

评注 本题关键在于两个方面, 一个则是先猜对答案, 发现仅 3 个格不到是极为关键的. 这点从较小的 $n$ 摸索是可以发现的. 另一个就是抓住特殊元素, 即左上角, 右下角, 分析就可以完善证明.

3. 给定奇数 $n>1$, 对 $1,2, \cdots, n$ 的一个排列 $p_{1}, \cdots, p_{n}$, 记 $S$ 为满足: 当 $1 \leq i \leq j \leq n$ 时, 有 $n \mid p_{i}+p_{i+1}+\cdots+p_{j}$ 的数对 $(i, j)$ 的数目. 求 $S$ 的最大值.

解 $1 S_{\max }=\frac{(n+1)(n+3)}{8}$.

(1) 一方面, 取 $\left(p_{1}, p_{2}, \cdots, p_{n}\right)=\left(n, 1, n-1,2, n-2, \cdots, \frac{n-1}{2}, \frac{n+1}{2}\right)$. 考虑 $n \mid p_{i}+\cdots+p_{j}$ 的 $(i, j)$ 对. 将 $n,(1, n-1),(2, n-2), \cdots,\left(\frac{n-1}{2}, \frac{n+1}{2}\right)$ 看作 $\frac{n+1}{2}$ 个整体. 任意取一个连续和均为一个满足要求的排列, 所以

$$
S \geq \mathrm{C}_{\frac{n+1}{2}}^{2}+\frac{n+1}{2}=\frac{(n+1)(n+3)}{8} .
$$

(2) 另一方面, 下面证明 $S \leq \frac{(n+1)(n+3)}{8}$.

为方便, 记

$$
\sigma_{i j}=p_{i}+p_{i+1}+\cdots+p_{j}, 1 \leq i \leq j \leq n .
$$

我们将其分为 3 类.

$$
\begin{aligned}
& A=\left\{(i, j)|n| \sigma_{i j} \text { 且 } p_{i}=n \text { 或 } p_{j}=n\right\}, \\
& B=\left\{(i, j)|n| \sigma_{i j} \text { 且 } n \mid p_{i}+p_{j} \text { 且 } p_{i}, p_{j} \neq n\right\}, \\
& C=\left\{(i, j)|n| \sigma_{i j} \text { 且 } n \nmid p_{i}+p_{j} \text { 且 } p_{i}, p_{j} \neq n\right\} .
\end{aligned}
$$

则 $S=|A|+|B|+|C|$.

设 $p_{t}=n$, 则 $(t, t) \in A,(t-1, t),(t, t+1)$ 均不在 $A, B, C$ 中. 先考虑 $(i, t), i<t-1$, 将数两两配对 (可能剩一个) 如下:

$$
((t-2, t),(t-3, t)),((t-4, t),(t-5, t)), \cdots
$$

每一对里最多一个在 $A$ 中, 否则 $n\left|\sigma_{i, t}, n\right| \sigma_{i-1, t},(i=t-2, t-4, \cdots)$ 两式
相减 $n \mid p_{i}$ 与 $i \neq t$ 矛盾!因此 $(i, t), i<t-1$ 中最多仅有 $\left[\frac{t-2+1}{2}\right]$ 个. 类似的 $(i, t), i>t+1$ 中最多仅有 $\left[\frac{n-t-1+1}{2}\right]$ 个. 所以

$$
|A| \leq\left[\frac{t-2+1}{2}\right]+\left[\frac{n-t-1+1}{2}\right]+1 \leq \frac{n+1}{2}(\text { 有 }(t, t) \in A)
$$

对 $B$ 中任意元素 $(i, j)$ 有 $n \mid p_{i}+p_{j}$. 最多 $\frac{n-1}{2}$ 对, 则 $|B| \leq \frac{n-1}{2}$.

再考虑 $C$ 中的元素, 注意到 $i, j \neq t$, 且 $n \mid n$. 故 $p_{t}$ 在哪对 $\sigma_{i j}$ 的 $\bmod n$ 的值无影响. 不妨设 $t=n$. 记 $K_{i}=\{2 i-1,2 i\}, 1 \leq i \leq \frac{n-1}{2}$. 注意到 $C$ 中的元素 $(i, j)$ 满足 $n \nmid p_{i}+p_{j}$. 因此 $(i, j)$ 不在同一个 $K_{u}\left(1 \leq u \leq \frac{n-1}{2}\right)$ 中.

设 $i \in K_{u_{1}}, j \in K_{u_{2}}, u_{1}<u_{2}$. 考虑 $\sigma_{2 u_{1}-1,2 u_{2}-1}, \sigma_{2 u_{1}-1,2 u_{2}}, \sigma_{2 u_{1}, 2 u_{2}-1}, \sigma_{2 u_{1}, 2 u_{2}}$.下证这四个元素最多有一个在 $C$ 中.

否则, 至少两个在 $C$ 中, 由于 $p_{2 u_{1}-1}, p_{2 u_{1}}, p_{2 u_{2}-1}, p_{2 u_{2}} \not \equiv 0(\bmod n)$.

若 $\left(2 u_{1}-1,2 u_{2}-1\right) \in C$, 则 $\left(2 u_{1}, 2 u_{2}-1\right) \notin C,\left(2 u_{1}-1,2 u_{2}\right) \notin C$. 从而 $\left(2 u_{1}, 2 u_{2}\right) \in C$. 于是 $p_{2 u_{1}-1} \equiv p_{2 u_{2}}(\bmod n)$, 矛盾!

故 $\left(2 u_{1}-1,2 u_{2}-1\right) \notin C$, 同理 $\left(2 u_{1}, 2 u_{2}\right) \notin C$ 则 $\left(2 u_{1}-1,2 u_{2}\right) \in$ $C,\left(2 u_{1}, 2 u_{2}-1\right) \in C$. 但由定义可知 $\left(2 u_{1}-1,2 u_{2}\right) \in B$, 矛盾!故 $\left(2 u_{1}-\right.$ $\left.1,2 u_{2}-1\right),\left(2 u_{1}-1,2 u_{2}\right),\left(2 u_{1}, 2 u_{2}-1\right),\left(2 u_{1}, 2 u_{2}\right)$ 最多一个在 $C$ 中, 可将 $K_{i}$看作整体 $1 \leq i \leq \frac{n-1}{2}$. 因此 $|C| \leq C_{\frac{n-2}{2}}^{2}$. 故

$$
S \leq|A|+|B|+|C| \leq \frac{n+1}{2}+\frac{n-1}{2}+C_{\frac{n-1}{2}}^{2}=\frac{(n+1)(n+3)}{8}
$$

综上, 有

$$
S_{\max }=\frac{(n+1)(n+3)}{8} .
$$

评注 答案是容易的, 重点在于估计, 此种解法完全按照构造的想法估计, 配对放缩. 虽略显繁琐但极其自然, 是算两次与一一对应的“典范”.

解 $2 S_{\max }=\mathrm{C}_{\frac{n+3}{2}}^{2}$.

记 $n=2 k+1, k \in \mathbb{N}^{*}$.

一方面, 构造 $p$ 使 $S \geq \mathrm{C}_{k+2}^{2}$.

取 $p_{2 i-1}=i, p_{2 i}=2 k+1-i, i=1, \cdots, k, p_{2 k+1}=2 k+1$, 则 $\forall i, j \in$ $\{0,2,4, \cdots, 2 k, 2 k+1\}, i<j$, 均有 $p_{i+1}+p_{i+2}+\cdots+p_{j}$ 为 $2 k+1$ 的倍数 (因为 $\left.2 k+1\left|p_{2 u-1}+p_{2 u}, u=1, \cdots, k, 2 k+1\right| p_{2 k+1}\right)$. 故 $S \geq \mathrm{C}_{k+2}^{2}$.

另一方面, 证明 $S \leq \mathrm{C}_{k+2}^{2}$.

记 $\sigma_{j}=p_{1}+p_{2}+\cdots+p_{j}, j=0,1, \cdots, 2 k+1$, 则 $\forall t \in \mathbb{Z}$, 满足 $1 \leq j \leq 2 k+1$
且 $\sigma_{j}-\sigma_{j-1} \equiv t(\bmod 2 k+1)$ 的 $j$ 恰有一个.于是, $\forall r \in \mathbb{Z}$, 满足 $0 \leq j \leq 2 k+1$且 $\sigma_{j} \equiv r(\bmod 2 k+1)$ 的 $j$ 至多 $k+2$ 个(因为这样的 $j$ 中相邻对至多一对).及 $\forall u, v \in \mathbb{Z}$, 满足 $0 \leq j \leq 2 k+1$ 且 $\sigma_{j} \equiv u$ 或 $v(\bmod 2 k+1)$ 的 $j$ 至多 $k+3$个(因为这样的 $j$ 中相邻对至多三对).

考虑

$$
\sigma_{u} \equiv \sigma_{v} \quad(\bmod 2 k+1)
$$

的有序组 $(u, v)$ 个数. 任取 $i \in\{0,1, \cdots, k\}$.

若 $\sigma_{2 i} \not \equiv \sigma_{2 i+1}(\bmod 2 k+1)$, 则满足 $\sigma_{j} \equiv \sigma_{2 i}$ 或 $\sigma_{2 i+1}(\bmod 2 k+1), 0 \leq$ $j \leq 2 k+1$ 的 $j$ 至多 $k+3$ 个, 则 $(*)$ 的满足 $v=2 i$ 或 $2 i+1$ 的解数至多 $k+3$ 个.

若 $\sigma_{2 i} \equiv \sigma_{2 i+1}(\bmod 2 k+1)$, 则满足 $\sigma_{j} \equiv \sigma_{2 i}(\bmod 2 k+1), 0 \leq j \leq 2 k+1$的 $j$ 至多 $k+2$ 个, 则 $(*)$ 的满足 $v=2 i$ 或 $2 i+1$ 的解数至多 $2(k+2)$ 个, 且此类 $i$ 至多一个.

因此, $(*)$ 解数至多 $k(k+3)+2(k+2)=k^{2}+5 k+4$.

于是, $\sigma_{u} \equiv \sigma_{v}$ 且 $u<v$ 的解 $(u, v)$ 至多

$$
\frac{1}{2}\left(\left(k^{2}+5 k+4\right)-(2 k+2)\right)=\frac{1}{2}\left(k^{2}+3 k+2\right) .
$$

即

$$
s \leq \mathrm{C}_{k+2}^{2}
$$

综上, $S_{\max }=\mathrm{C}_{\frac{n+3}{2}}^{2}$.

评注 本题将连续若干项的和化为部分和能看起来清晰一点, 也是常见手法. 单纯用单个项去计数会不太够, 结合取等, 便退一步考虑两项一起计。

